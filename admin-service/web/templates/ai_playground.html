{{define "title"}}{{.PageTitle}}{{end}}

{{define "content"}}
<div class="container">
    <h2>{{.PageTitle}}</h2>
    <p>Экспериментальная площадка для взаимодействия с AI генератором.</p>

    <form id="ai-form" class="data-form">
        <label for="system_prompt">
            Системный промпт
        </label>
        <textarea id="system_prompt" name="system_prompt" rows="5" placeholder="Например: Ты полезный ассистент."></textarea>
        
        <label for="user_prompt">
            Пользовательский промпт
        </label>
        <textarea id="user_prompt" name="user_prompt" rows="10" required placeholder="Например: Напиши короткую историю о космосе."></textarea>
        
        <fieldset>
            <legend>Настройки генерации</legend>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                <div>
                    <label for="temperature">
                        Temperature (0.0 - 2.0)
                    </label>
                    <input type="number" id="temperature" name="temperature" min="0" max="2" step="0.1" value="0.7">
                </div>
                <div>
                    <label for="max_tokens">
                        Max Tokens
                    </label>
                    <input type="number" id="max_tokens" name="max_tokens" min="1" step="1" value="512">
                </div>
                <div>
                    <label for="top_p">
                        Top P (0.0 - 1.0)
                    </label>
                    <input type="number" id="top_p" name="top_p" min="0" max="1" step="0.1" value="1.0">
                </div>
            </div>
        </fieldset>

        <button type="submit" id="generate-btn" class="cta-button cta-button--primary" style="margin-top: 1rem;">Сгенерировать</button>
    </form>

    <div id="result-container" style="margin-top: 2rem;">
        <h6>Результат генерации:</h6>
        <pre id="ai-result" style="white-space: pre-wrap; word-wrap: break-word; background-color: var(--card-background); border: 1px solid rgba(0, 195, 253, 0.2); color: var(--text-color); padding: 15px; border-radius: 5px; min-height: 100px; font-family: monospace;"></pre>
    </div>
</div>

<script>
    const form = document.getElementById('ai-form');
    const systemPromptInput = document.getElementById('system_prompt');
    const userPromptInput = document.getElementById('user_prompt');
    const resultPre = document.getElementById('ai-result');
    const generateBtn = document.getElementById('generate-btn');
    const generateBtnOriginalText = generateBtn.textContent;

    form.addEventListener('submit', async (event) => {
        event.preventDefault();
        resultPre.textContent = 'Генерация...';
        generateBtn.textContent = 'Генерация...';
        generateBtn.disabled = true;
        generateBtn.style.opacity = '0.7';
        generateBtn.style.cursor = 'wait';

        const formData = new FormData(form);

        const params = new URLSearchParams();
        params.append('temperature', formData.get('temperature') || '0.7');
        params.append('max_tokens', formData.get('max_tokens') || '512');
        params.append('top_p', formData.get('top_p') || '1.0');
        const queryString = params.toString();

        try {
            const fetchURL = `/admin/ai-playground/generate?${queryString}`;
            console.log('Fetch URL:', fetchURL);

            const response = await fetch(fetchURL, {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'text/plain'
                }
            });

            const responseText = await response.text();

            if (!response.ok) {
                console.error('Server error:', response.status, responseText);
                resultPre.innerHTML = `<span style="color: #ff8a8a;">[Ошибка сервера ${response.status}]</span><br>${responseText}`;
            } else {
                resultPre.textContent = responseText;
            }

        } catch (error) {
            console.error('Fetch failed:', error);
            resultPre.innerHTML = '<span style="color: #ff8a8a;">[Ошибка сети или соединения]</span>';
        } finally {
            generateBtn.textContent = generateBtnOriginalText;
            generateBtn.disabled = false;
            generateBtn.style.opacity = '1';
            generateBtn.style.cursor = 'pointer';
        }
    });
</script>
{{end}} 