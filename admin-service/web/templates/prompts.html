{{ template "layout.html" . }}

{{ define "title" }}Управление Промптами{{ end }}

{{ define "content" }}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>{{ .title }}</h1>

        <!-- Flash Message Display (Новый блок) -->
        {{ if .flashMessage }}
            <div class="alert alert-{{ if eq .flashType "success" }}success{{ else }}danger{{ end }} alert-dismissible fade show" role="alert">
                {{ .flashMessage }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {{ end }}
        <!-- End Flash Message Display -->

        <div class="mb-3">
            <a href="/admin/prompts/new" class="btn btn-primary">Add New Prompt</a>
        </div>

        {{if not .prompts}}
        <div class="alert alert-info">No prompts found.</div>
        {{else}}
        <div class="app-container">
            <nav class="breadcrumbs">
                <ul>
                    <li><a href="/admin/dashboard">Дашборд</a></li>
                    <li>Управление Промптами</li>
                </ul>
            </nav>

            <h1>Управление Промптами</h1>

            <!-- Старые блоки Flash - их нужно удалить -->
            {{ if .SuccessMessage }}
                <div class="system-message system-message--success">{{ .SuccessMessage }}</div>
            {{ end }}
            {{ if .ErrorMessage }}
                <div class="system-message system-message--error">{{ .ErrorMessage }}</div>
            {{ end }}
            <!-- Конец старых блоков -->

            <div class="button-group mb-3">
                <a href="/admin/prompts/new" class="cta-button cta-button--success">Создать Ключ Промпта</a>
            </div>

            <table class="data-table">
                <thead>
                <tr>
                    <th>Ключ</th>
                    <th>Действия</th>
                </tr>
                </thead>
                <tbody>
                <!-- Нужно итерировать по .prompts, а не .PromptKeys -->
                {{ range .prompts }} <!-- ИЗМЕНЕНО: Итерация по .prompts -->
                <tr>
                    <td>{{ .Key }}</td> <!-- ИЗМЕНЕНО: Используем поля структуры Prompt -->
                    <td>
                        <div class="button-group" style="justify-content: flex-start;">
                            <!-- Ссылка на редактирование должна использовать ID промпта -->
                            <a href="/admin/prompts/{{ .ID }}/edit" class="cta-button cta-button--primary btn-sm">Редактировать</a>
                            <!-- Форма удаления должна использовать ID промпта -->
                            <form action="/admin/prompts/{{ .ID }}" method="post" style="display: inline; margin: 0;" onsubmit="return confirm('Вы уверены, что хотите удалить промпт {{ .Key }} ({{ .Language }})?');">
                                <input type="hidden" name="_method" value="DELETE"> <!-- Используем метод DELETE -->
                                <button type="submit" class="cta-button cta-button--danger btn-sm">Удалить</button>
                            </form>
                         </div>
                    </td>
                </tr>
                {{ else }}
                <tr>
                    <td colspan="2" style="text-align: center;">Промпты не найдены.</td>
                </tr>
                {{ end }}
                </tbody>
            </table>
        </div>
        {{ end }}
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
{{ end }} 