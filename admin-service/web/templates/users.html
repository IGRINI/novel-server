{{ template "layout.html" . }}

{{ define "title" }}Пользователи{{ end }}

{{ define "content" }}
    <!-- <nav aria-label="breadcrumb">
        <ul>
            <li><a href="/admin/dashboard">Дашборд</a></li>
            <li><a href="/admin/users">Пользователи</a></li>
            <li><a href="/admin/logout">Выход</a></li>
        </ul>
    </nav> -->

    <h1>{{ .PageTitle }}</h1>

    {{ if .Error }}
        <p class="system-message system-message--error">{{ .Error }}</p>
    {{ end }}

    <table class="data-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Username</th>
                <th>Email</th>
                <th>Роли</th>
                <th>Статус</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {{ range .Users }}
                <tr>
                    <td>{{ .ID }}</td>
                    <td>{{ .Username }}</td>
                    <td>{{ .Email }}</td>
                    <td>{{ range .Roles }}{{ . }} {{ end }}</td>
                    <td>
                        {{ if .IsBanned }}
                            <span style="color: red;">Забанен</span>
                        {{ else }}
                            <span>Активен</span>
                        {{ end }}
                    </td>
                    <td>
                        <a href="/admin/users/{{ .ID }}/edit" role="button" class="cta-button cta-button--secondary" style="margin-right: 0.5em;">Редакт.</a>
                        {{/* Кнопка бана/разбана с HTMX */}}
                        {{ if .IsBanned }}
                            <button class="cta-button cta-button--secondary" 
                                    hx-delete="/admin/users/{{ .ID }}/ban" 
                                    hx-confirm="Вы уверены, что хотите разбанить пользователя {{ .Username }}?"
                                    hx-target="closest tr" {{/* Можно заменить на hx-target="body" если используем HX-Refresh */}}
                                    hx-swap="outerHTML"> {{/* Можно заменить на hx-swap="none" если используем HX-Refresh */}}
                                Разбанить
                            </button>
                        {{ else }}
                            <button class="cta-button cta-button--secondary" 
                                    hx-post="/admin/users/{{ .ID }}/ban" 
                                    hx-confirm="Вы уверены, что хотите забанить пользователя {{ .Username }}?"
                                    hx-target="closest tr" {{/* Можно заменить на hx-target="body" если используем HX-Refresh */}}
                                    hx-swap="outerHTML"> {{/* Можно заменить на hx-swap="none" если используем HX-Refresh */}}
                                Бан
                            </button>
                        {{ end }}
                    </td>
                </tr>
            {{ else }}
                <tr>
                    <td colspan="6">Пользователи не найдены.</td>
                </tr>
            {{ end }}
        </tbody>
    </table>

    {{/* Пагинация */}}
    <nav aria-label="Pagination">
        <ul>
            <li>
                {{ if .NextCursor }}
                    <a href="/admin/users?limit={{ .Limit }}&after={{ .NextCursor }}" role="button" class="cta-button">Следующая страница →</a>
                {{ else }}
                    <button disabled aria-disabled="true" class="cta-button" style="opacity: 0.6; cursor: not-allowed;">Следующая страница →</button>
                {{ end }}
            </li>
        </ul>
    </nav>

{{ end }} 