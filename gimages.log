2025-05-21 21:42:10.923 | 2025/05/21 18:42:10 [DIAG] Перед envconfig.Process: RABBITMQ_URL='amqp://guest:guest@rabbitmq:5672/', RABBITMQ_CHARACTER_IMAGE_TASK_QUEUE_NAME='image_generation_tasks'
2025-05-21 21:42:10.923 | 2025/05/21 18:42:10 [DIAG] Ошибка envconfig.Process: <nil>
2025-05-21 21:42:10.923 | 2025/05/21 18:42:10 [DIAG] После envconfig.Process: cfg.RabbitMQ.URL='amqp://guest:guest@rabbitmq:5672/', cfg.RabbitMQ.TaskQueue.Name='image_generation_tasks'
2025-05-21 21:42:10.923 | 2025/05/21 18:42:10 Configuration loaded for Image Generator:
2025-05-21 21:42:10.923 | 2025/05/21 18:42:10   App Env: development
2025-05-21 21:42:10.923 | 2025/05/21 18:42:10   Logger Level: 
2025-05-21 21:42:10.923 | 2025/05/21 18:42:10   RabbitMQ URL: amqp://guest:guest@rabbitmq:5672/
2025-05-21 21:42:10.923 | 2025/05/21 18:42:10   RabbitMQ Consumer Name: image_generator_worker
2025-05-21 21:42:10.923 | 2025/05/21 18:42:10   RabbitMQ Task Queue Name: image_generation_tasks
2025-05-21 21:42:10.923 | 2025/05/21 18:42:10   RabbitMQ Result Queue Name: image_generation_results
2025-05-21 21:42:10.923 | 2025/05/21 18:42:10   SANA Base URL: http://host.docker.internal:8000
2025-05-21 21:42:10.923 | 2025/05/21 18:42:10   SANA Timeout: 2m0s
2025-05-21 21:42:10.923 | 2025/05/21 18:42:10   Pushgateway URL: http://pushgateway:9091
2025-05-21 21:42:10.923 | 2025/05/21 18:42:10   Image Save Path: /app/generated_images
2025-05-21 21:42:10.923 | 2025/05/21 18:42:10   Image Public Base URL: https://crion.space/generated-images
2025-05-21 21:42:10.923 | {"level":"INFO","timestamp":"2025-05-21T18:42:10.923Z","msg":"Logger initialized","level":""}
2025-05-21 21:42:10.923 | {"level":"INFO","timestamp":"2025-05-21T18:42:10.923Z","msg":"Loaded RabbitMQ Task Queue Config","task_queue_name_from_config":"image_generation_tasks","task_queue_durable":true}
2025-05-21 21:42:10.923 | {"level":"INFO","timestamp":"2025-05-21T18:42:10.923Z","msg":"Starting Image Generator Worker...","env":"development"}
2025-05-21 21:42:10.923 | {"level":"INFO","timestamp":"2025-05-21T18:42:10.923Z","msg":"Image generation service initialized"}
2025-05-21 21:42:10.923 | {"level":"INFO","timestamp":"2025-05-21T18:42:10.923Z","msg":"Attempting to connect to RabbitMQ...","max_attempts":50,"delay":5}
2025-05-21 21:42:10.926 | {"level":"INFO","timestamp":"2025-05-21T18:42:10.926Z","msg":"RabbitMQ connected successfully","attempt":1}
2025-05-21 21:42:10.926 | {"level":"INFO","timestamp":"2025-05-21T18:42:10.926Z","msg":"RabbitMQ connected successfully"}
2025-05-21 21:42:10.927 | {"level":"INFO","timestamp":"2025-05-21T18:42:10.927Z","msg":"RabbitMQ channel opened successfully"}
2025-05-21 21:42:10.927 | {"level":"INFO","timestamp":"2025-05-21T18:42:10.927Z","msg":"Setting up Dead Letter Exchange and Queue","dlx":"image_generation_tasks_dlx","dlq":"image_generation_tasks_dlq"}
2025-05-21 21:42:10.954 | {"level":"INFO","timestamp":"2025-05-21T18:42:10.954Z","msg":"DLX/DLQ setup complete"}
2025-05-21 21:42:10.966 | {"level":"INFO","timestamp":"2025-05-21T18:42:10.966Z","msg":"RabbitMQ result publisher initialized"}
2025-05-21 21:42:10.966 | {"level":"INFO","timestamp":"2025-05-21T18:42:10.966Z","msg":"Prometheus Pusher initialized","url":"http://pushgateway:9091","instance":"72336d99ea0a"}
2025-05-21 21:42:10.966 | {"level":"INFO","timestamp":"2025-05-21T18:42:10.966Z","msg":"Message handler initialized"}
2025-05-21 21:42:10.966 | {"level":"INFO","timestamp":"2025-05-21T18:42:10.966Z","msg":"Image Generator Worker started successfully"}
2025-05-21 21:42:10.976 | {"level":"INFO","timestamp":"2025-05-21T18:42:10.976Z","msg":"Task queue declared with DLX args","queue":"image_generation_tasks","messages":0,"consumers":0}
2025-05-21 21:42:10.977 | {"level":"INFO","timestamp":"2025-05-21T18:42:10.977Z","msg":"Consumer started, waiting for messages on shared channel...","queue":"image_generation_tasks"}
2025-05-21 21:42:52.520 | {"level":"INFO","timestamp":"2025-05-21T18:42:52.520Z","msg":"Received single character image generation task","task_id":"c0f8d2ba-66d8-4903-ad40-f1366943c802","correlation_id":""}
2025-05-21 21:42:52.520 | {"level":"INFO","timestamp":"2025-05-21T18:42:52.520Z","msg":"Generating character image...","character_id":"00000000-0000-0000-0000-000000000000","image_reference":"card_hidden_alley_encounter","prompt_hash":"66323564343832332d366337662d353463632d386232312d653633666663373562626563","task_id":"c0f8d2ba-66d8-4903-ad40-f1366943c802"}
2025-05-21 21:42:52.520 | {"level":"INFO","timestamp":"2025-05-21T18:42:52.520Z","msg":"Using image ratio from task payload","character_id":"00000000-0000-0000-0000-000000000000","image_reference":"card_hidden_alley_encounter","prompt_hash":"66323564343832332d366337662d353463632d386232312d653633666663373562626563","task_id":"c0f8d2ba-66d8-4903-ad40-f1366943c802","ratio":"2:3","reference":"card_hidden_alley_encounter"}
2025-05-21 21:42:53.169 | {"level":"INFO","timestamp":"2025-05-21T18:42:53.169Z","msg":"Image data received from SANA","character_id":"00000000-0000-0000-0000-000000000000","image_reference":"card_hidden_alley_encounter","prompt_hash":"66323564343832332d366337662d353463632d386232312d653633666663373562626563","task_id":"c0f8d2ba-66d8-4903-ad40-f1366943c802","size_bytes":51435}
2025-05-21 21:42:53.169 | {"level":"INFO","timestamp":"2025-05-21T18:42:53.169Z","msg":"Image saved to file","character_id":"00000000-0000-0000-0000-000000000000","image_reference":"card_hidden_alley_encounter","prompt_hash":"66323564343832332d366337662d353463632d386232312d653633666663373562626563","task_id":"c0f8d2ba-66d8-4903-ad40-f1366943c802","path":"/app/generated_images/card_hidden_alley_encounter.jpg"}
2025-05-21 21:42:53.169 | {"level":"INFO","timestamp":"2025-05-21T18:42:53.169Z","msg":"Public image URL generated","character_id":"00000000-0000-0000-0000-000000000000","image_reference":"card_hidden_alley_encounter","prompt_hash":"66323564343832332d366337662d353463632d386232312d653633666663373562626563","task_id":"c0f8d2ba-66d8-4903-ad40-f1366943c802","url":"https://crion.space/generated-images/card_hidden_alley_encounter.jpg"}
2025-05-21 21:42:53.169 | {"level":"INFO","timestamp":"2025-05-21T18:42:53.169Z","msg":"Successfully processed and published notification for single task","task_id":"c0f8d2ba-66d8-4903-ad40-f1366943c802","correlation_id":"","character_id":"00000000-0000-0000-0000-000000000000","published_story_id":"2abf0b48-d02f-4baa-aa3b-4ef51b53bc58","image_reference":"card_hidden_alley_encounter"}
2025-05-21 21:42:53.174 | {"level":"INFO","timestamp":"2025-05-21T18:42:53.173Z","msg":"Received single character image generation task","task_id":"d2168ac5-637d-499a-86c4-c0f64d2c54c9","correlation_id":""}
2025-05-21 21:42:53.174 | {"level":"INFO","timestamp":"2025-05-21T18:42:53.173Z","msg":"Generating character image...","character_id":"00000000-0000-0000-0000-000000000000","image_reference":"card_magical_symbol_clue","prompt_hash":"66323564343832332d366337662d353463632d386232312d653633666663373562626563","task_id":"d2168ac5-637d-499a-86c4-c0f64d2c54c9"}
2025-05-21 21:42:53.174 | {"level":"INFO","timestamp":"2025-05-21T18:42:53.173Z","msg":"Using image ratio from task payload","character_id":"00000000-0000-0000-0000-000000000000","image_reference":"card_magical_symbol_clue","prompt_hash":"66323564343832332d366337662d353463632d386232312d653633666663373562626563","task_id":"d2168ac5-637d-499a-86c4-c0f64d2c54c9","ratio":"2:3","reference":"card_magical_symbol_clue"}
2025-05-21 21:42:53.591 | {"level":"INFO","timestamp":"2025-05-21T18:42:53.591Z","msg":"Image data received from SANA","character_id":"00000000-0000-0000-0000-000000000000","image_reference":"card_magical_symbol_clue","prompt_hash":"66323564343832332d366337662d353463632d386232312d653633666663373562626563","task_id":"d2168ac5-637d-499a-86c4-c0f64d2c54c9","size_bytes":48123}
2025-05-21 21:42:53.591 | {"level":"INFO","timestamp":"2025-05-21T18:42:53.591Z","msg":"Image saved to file","character_id":"00000000-0000-0000-0000-000000000000","image_reference":"card_magical_symbol_clue","prompt_hash":"66323564343832332d366337662d353463632d386232312d653633666663373562626563","task_id":"d2168ac5-637d-499a-86c4-c0f64d2c54c9","path":"/app/generated_images/card_magical_symbol_clue.jpg"}
2025-05-21 21:42:53.591 | {"level":"INFO","timestamp":"2025-05-21T18:42:53.591Z","msg":"Public image URL generated","character_id":"00000000-0000-0000-0000-000000000000","image_reference":"card_magical_symbol_clue","prompt_hash":"66323564343832332d366337662d353463632d386232312d653633666663373562626563","task_id":"d2168ac5-637d-499a-86c4-c0f64d2c54c9","url":"https://crion.space/generated-images/card_magical_symbol_clue.jpg"}
2025-05-21 21:42:53.591 | {"level":"INFO","timestamp":"2025-05-21T18:42:53.591Z","msg":"Successfully processed and published notification for single task","task_id":"d2168ac5-637d-499a-86c4-c0f64d2c54c9","correlation_id":"","character_id":"00000000-0000-0000-0000-000000000000","published_story_id":"2abf0b48-d02f-4baa-aa3b-4ef51b53bc58","image_reference":"card_magical_symbol_clue"}
2025-05-21 21:50:10.200 | {"level":"INFO","timestamp":"2025-05-21T18:50:10.199Z","msg":"Received single character image generation task","task_id":"9d859e00-7707-4533-871e-399f27fe0253","correlation_id":""}
2025-05-21 21:50:10.200 | {"level":"INFO","timestamp":"2025-05-21T18:50:10.199Z","msg":"Generating character image...","character_id":"00000000-0000-0000-0000-000000000000","image_reference":"card_market_stall_theft","prompt_hash":"66323564343832332d366337662d353463632d386232312d653633666663373562626563","task_id":"9d859e00-7707-4533-871e-399f27fe0253"}
2025-05-21 21:50:10.200 | {"level":"INFO","timestamp":"2025-05-21T18:50:10.200Z","msg":"Using image ratio from task payload","character_id":"00000000-0000-0000-0000-000000000000","image_reference":"card_market_stall_theft","prompt_hash":"66323564343832332d366337662d353463632d386232312d653633666663373562626563","task_id":"9d859e00-7707-4533-871e-399f27fe0253","ratio":"2:3","reference":"card_market_stall_theft"}
2025-05-21 21:50:11.064 | {"level":"INFO","timestamp":"2025-05-21T18:50:11.063Z","msg":"Image data received from SANA","character_id":"00000000-0000-0000-0000-000000000000","image_reference":"card_market_stall_theft","prompt_hash":"66323564343832332d366337662d353463632d386232312d653633666663373562626563","task_id":"9d859e00-7707-4533-871e-399f27fe0253","size_bytes":45736}
2025-05-21 21:50:11.064 | {"level":"INFO","timestamp":"2025-05-21T18:50:11.063Z","msg":"Image saved to file","character_id":"00000000-0000-0000-0000-000000000000","image_reference":"card_market_stall_theft","prompt_hash":"66323564343832332d366337662d353463632d386232312d653633666663373562626563","task_id":"9d859e00-7707-4533-871e-399f27fe0253","path":"/app/generated_images/card_market_stall_theft.jpg"}
2025-05-21 21:50:11.064 | {"level":"INFO","timestamp":"2025-05-21T18:50:11.063Z","msg":"Public image URL generated","character_id":"00000000-0000-0000-0000-000000000000","image_reference":"card_market_stall_theft","prompt_hash":"66323564343832332d366337662d353463632d386232312d653633666663373562626563","task_id":"9d859e00-7707-4533-871e-399f27fe0253","url":"https://crion.space/generated-images/card_market_stall_theft.jpg"}
2025-05-21 21:50:11.064 | {"level":"INFO","timestamp":"2025-05-21T18:50:11.064Z","msg":"Successfully processed and published notification for single task","task_id":"9d859e00-7707-4533-871e-399f27fe0253","correlation_id":"","character_id":"00000000-0000-0000-0000-000000000000","published_story_id":"cc8e963d-621e-4464-9f14-1fe2503a2ea7","image_reference":"card_market_stall_theft"}
2025-05-21 21:50:11.067 | {"level":"INFO","timestamp":"2025-05-21T18:50:11.066Z","msg":"Received single character image generation task","task_id":"faf7e5d3-f703-49c1-87b4-8294409ab950","correlation_id":""}
2025-05-21 21:50:11.067 | {"level":"INFO","timestamp":"2025-05-21T18:50:11.066Z","msg":"Generating character image...","character_id":"00000000-0000-0000-0000-000000000000","image_reference":"card_mysterious_potion","prompt_hash":"66323564343832332d366337662d353463632d386232312d653633666663373562626563","task_id":"faf7e5d3-f703-49c1-87b4-8294409ab950"}
2025-05-21 21:50:11.067 | {"level":"INFO","timestamp":"2025-05-21T18:50:11.066Z","msg":"Using image ratio from task payload","character_id":"00000000-0000-0000-0000-000000000000","image_reference":"card_mysterious_potion","prompt_hash":"66323564343832332d366337662d353463632d386232312d653633666663373562626563","task_id":"faf7e5d3-f703-49c1-87b4-8294409ab950","ratio":"2:3","reference":"card_mysterious_potion"}
2025-05-21 21:50:11.525 | {"level":"INFO","timestamp":"2025-05-21T18:50:11.525Z","msg":"Image data received from SANA","character_id":"00000000-0000-0000-0000-000000000000","image_reference":"card_mysterious_potion","prompt_hash":"66323564343832332d366337662d353463632d386232312d653633666663373562626563","task_id":"faf7e5d3-f703-49c1-87b4-8294409ab950","size_bytes":43918}
2025-05-21 21:50:11.526 | {"level":"INFO","timestamp":"2025-05-21T18:50:11.526Z","msg":"Image saved to file","character_id":"00000000-0000-0000-0000-000000000000","image_reference":"card_mysterious_potion","prompt_hash":"66323564343832332d366337662d353463632d386232312d653633666663373562626563","task_id":"faf7e5d3-f703-49c1-87b4-8294409ab950","path":"/app/generated_images/card_mysterious_potion.jpg"}
2025-05-21 21:50:11.526 | {"level":"INFO","timestamp":"2025-05-21T18:50:11.526Z","msg":"Public image URL generated","character_id":"00000000-0000-0000-0000-000000000000","image_reference":"card_mysterious_potion","prompt_hash":"66323564343832332d366337662d353463632d386232312d653633666663373562626563","task_id":"faf7e5d3-f703-49c1-87b4-8294409ab950","url":"https://crion.space/generated-images/card_mysterious_potion.jpg"}
2025-05-21 21:50:11.526 | {"level":"INFO","timestamp":"2025-05-21T18:50:11.526Z","msg":"Successfully processed and published notification for single task","task_id":"faf7e5d3-f703-49c1-87b4-8294409ab950","correlation_id":"","character_id":"00000000-0000-0000-0000-000000000000","published_story_id":"cc8e963d-621e-4464-9f14-1fe2503a2ea7","image_reference":"card_mysterious_potion"}